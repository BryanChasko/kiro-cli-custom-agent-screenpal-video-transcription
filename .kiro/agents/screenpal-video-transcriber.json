{
  "name": "screenpal-video-transcriber",
  "description": "Specialized agent for processing ScreenPal videos with audio transcription and visual analysis using local AI models",
  "prompt": "You are a specialized ScreenPal video transcription agent with comprehensive toolchain verification. Before processing any ScreenPal URLs, you MUST execute a mandatory diagnostic sequence: 1) Verify uvx video-transcriber-mcp --help returns exit code 0, 2) Verify uvx mcp-vision-analysis --help returns exit code 0, 3) Confirm Ollama API responds to curl http://localhost:11434/api/tags, 4) Check ollama list contains moondream2 model (auto-pull if missing). Only after successful verification, orchestrate the media processing pipeline: yt-dlp extracts ScreenPal manifest, FFmpeg handles 16kHz mono PCM audio normalization and scene-change frame extraction, parallel Whisper/VLM engines generate timestamped, visually-annotated knowledge base entries in ./knowledge/ directory. Always prioritize local processing, maintain temporal context, and ensure complete privacy.",
  "mcpServers": {
    "video-transcriber": {
      "command": "uvx",
      "args": ["video-transcriber-mcp"],
      "env": {
        "WHISPER_MODEL": "base",
        "YOUTUBE_FORMAT": "bestaudio",
        "WHISPER_DEVICE": "cpu"
      },
      "timeout": 300000
    },
    "vision-analysis": {
      "command": "uvx",
      "args": ["mcp-vision-analysis"],
      "env": {
        "OLLAMA_API_ENDPOINT": "http://localhost:11434",
        "VLM_MODEL": "moondream2",
        "SCENE_THRESHOLD": "0.4",
        "MAX_FRAMES": "50"
      },
      "timeout": 180000
    }
  },
  "tools": [
    "fs_read",
    "fs_write",
    "knowledge",
    "@video-transcriber/transcribe_video",
    "@video-transcriber/extract_audio",
    "@video-transcriber/get_video_info",
    "@vision-analysis/analyze_frames",
    "@vision-analysis/detect_scene_changes",
    "@vision-analysis/compare_frames",
    "@vision-analysis/extract_keyframes"
  ],
  "allowedTools": [
    "fs_read",
    "knowledge",
    "@video-transcriber/get_video_info",
    "@vision-analysis/extract_keyframes"
  ],
  "toolsSettings": {
    "fs_write": {
      "allowedPaths": [
        "transcripts/**",
        "output/**",
        "temp/**"
      ]
    },
    "@video-transcriber/transcribe_video": {
      "maxDuration": 3600,
      "allowedDomains": ["go.screenpal.com", "screenpal.com"]
    },
    "@vision-analysis/analyze_frames": {
      "maxFrames": 100,
      "allowedFormats": ["png", "jpg", "jpeg"]
    }
  },
  "resources": [
    "file://knowledge/**/*.md",
    "file://README.md",
    "file://USAGE.md"
  ],
  "hooks": {
    "agentSpawn": [
      {
        "command": "echo 'ğŸ¬ ScreenPal Video Transcriber Agent initialized. Running mandatory verification sequence...'"
      },
      {
        "command": "uvx video-transcriber-mcp --help > /dev/null 2>&1 && echo 'âœ… video-transcriber-mcp verified' || echo 'âŒ video-transcriber-mcp failed'"
      },
      {
        "command": "uvx mcp-vision-analysis --help > /dev/null 2>&1 && echo 'âœ… mcp-vision-analysis verified' || echo 'âŒ mcp-vision-analysis failed'"
      },
      {
        "command": "curl -s http://localhost:11434/api/tags > /dev/null 2>&1 && echo 'âœ… Ollama API responsive' || echo 'âŒ Ollama API not responding'"
      },
      {
        "command": "docker exec ollama-screenpal ollama list 2>/dev/null | grep -q moondream2 && echo 'âœ… Moondream2 model available' || echo 'âš ï¸ Moondream2 model missing - triggering background pull'"
      }
    ],
    "preToolUse": [
      {
        "matcher": "@video-transcriber/transcribe_video",
        "command": "echo 'ğŸµ Starting yt-dlp extraction and Whisper transcription pipeline...'"
      },
      {
        "matcher": "@vision-analysis/*",
        "command": "echo 'ğŸ‘ï¸ Initiating FFmpeg scene detection and VLM visual analysis...'"
      }
    ],
    "postToolUse": [
      {
        "matcher": "fs_write",
        "command": "echo 'ğŸ’¾ Timestamped, visually-annotated output saved to ./knowledge/ directory'"
      }
    ]
  },
  "includeMcpJson": false,
  "model": "claude-sonnet-4"
}
